/**
 * @license MIT
 * @author Luca Poldelmengo
 * @see {@link https://github.com/pldg/scrollzzz}
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).scrollzzz=t()}(this,(function(){"use strict";function e(e){return"number"==typeof e&&!isNaN(parseFloat(e))}function t(e){return"string"==typeof e&&e.length>0}return function(n){var r=n.trigger;void 0===r&&(r=1);var o=n.progress;void 0===o&&(o=!1);var i=n.debug;void 0===i&&(i=!1);var s=n.root;void 0===s&&(s=null);var u,c,l,a,d,f,p=n.targets,v=n.unobserve,g=n.throttle,w=(u=0,c="down",function(){var e=s?s.scrollTop:window.pageYOffset,t=c;return e>u||e===u&&"down"===c?t="down":(e<u||e===u&&"up"===c)&&(t="up"),u=e,c=t,t}),b={},h=[],y=!1,m=!!o&&function(){var e=!1;try{var t={get passive(){e={passive:!0}}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}(),z=[],E=!0;function x(e){var t=document.createElement("div"),n=document.createElement("p");if(t.style.height="0px",t.style.borderTop="2px dashed grey",t.style.zIndex="9999",e){var o=e.getBoundingClientRect(),i=o.height,s=o.width;t.style.position="absolute",t.style.top=r*i+function(e){var t=window.pageYOffset,n=window.pageXOffset,r=document.body.clientTop||0,o=document.body.clientLeft||0,i=e.getBoundingClientRect(),s=i.top,u=i.left,c=i.height,l=i.width;return{top:s=s+t-r,left:u=u+n-o,height:c,width:l,bottom:s+c,right:u+l}}(e).top+"px",t.style.width=s+"px"}else t.style.position="fixed",t.style.width="100%",t.style.top=100*r+"vh";n.style.fontFamily="monospace",n.style.color="grey",n.style.margin="0",n.style.padding="6px",n.innerText='targets: "'+p+'", trigger: '+r,t.setAttribute("class",L()),t.appendChild(n),document.body.appendChild(t)}function L(){return"scrollzzz-trigger--"+("."===p[0]||"#"===p[0]?p.substring(1):p)}function O(e,t){o&&(f=e[0].rootBounds.top),d&&e.forEach((function(e){var n=function(e){var t=e.isIntersecting,n=e.rootBounds.top,r=e.boundingClientRect.top>n;return t?"intersect":!t&&r?"below":"above"}(e),r=e.target,i=parseInt(r.dataset.scrollzzz);d({direction:w(),progress:o?S(e):null,position:n,entry:e}),o&&E&&function(e){var t=function(e){return g?(t=o,n=g,r=Date.now(),function(){r+n-Date.now()<0&&(t(),r=Date.now())}):o;var t,n,r;function o(t){d({direction:w(),progress:S(e),position:"intersect",entry:e})}}(e);z.push({addScroll:function(){return window.addEventListener("scroll",t,m)},removeScroll:function(){return window.removeEventListener("scroll",t,m)}})}(e),o&&function(e,t){var n=e.isIntersecting,r=z[t],o=r.addScroll,i=r.removeScroll;n?o():n||E||i()}(e,i),v&&(!function(e,t,n){var r="below"===v&&"below"===e,o="intersect"===v&&"intersect"===e,i="above"===v&&"above"===e;("onLoad"===v||r||o||i)&&n.unobserve(t)}(n,r,t),h.push(i))})),E&&(E=!1)}function S(e){var t=e.target.getBoundingClientRect(),n=t.top,r=1/(t.height/(f-n));return r<0?0:r>1?1:parseFloat(r.toFixed(4))}function C(){throw new Error("scrollzzz has not been initialized")}return b.init=function(){if(y)throw new Error("scrollzzz has beed already initialized");var n;return function(){if(t(p)||n("targets"),!e(r)||r>1||r<0)throw new Error("trigger must be a number in 0..1 range");if(v){if(!(["onLoad","below","intersect","above"].indexOf(v)>-1))throw new Error('unobserve must be "onLoad" or "below" or "intersect" or "above"');if(o&&"intersecting"===v)throw new Error('if using progress, unobserve can not be "intersect"')}if(!e(g)&&g>0)throw new Error("throttle must be a number > 0");function n(e){throw new Error(e+" must be a valid DOM selector")}s&&!t(s)&&n("root")}(),t(s)&&(l=document.querySelector(s)),!0===i&&x(l),a=new IntersectionObserver(O,{rootMargin:(n=100*r,"-"+n+"% 0% -"+(100-n)+"% 0%"),root:l||null}),[].slice.call(document.querySelectorAll(p)).forEach((function(e,t){e.hasAttribute("data-scrollzzz")||e.setAttribute("data-scrollzzz",t),-1===h.indexOf(t)&&a.observe(e)})),y=!0,b},b.observe=function(e){if(y||C(),"function"!=typeof e)throw new Error("observe requires a function");return d=e,b},b.disconnect=function(e){var t;return void 0===e&&(e=!1),y||C(),o&&z.forEach((function(e){return(0,e.removeScroll)()})),!0===i&&(t=document.querySelector("."+L())).parentNode.removeChild(t),e&&h.splice(0),a.disconnect(),y=!1,b},b.update=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=!1),b.disconnect(t),p=e.targets||p,r=e.trigger||r,v=e.unobserve||v,o=e.progress||o,g=e.throttle||g,s=e.root||s,i=e.debug||i,b.init(),b},Object.freeze(b)}}));
