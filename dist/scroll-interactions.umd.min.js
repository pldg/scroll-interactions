/**
 * @author Luca Poldelmengo
 * @license MIT
 * @see {@link https://github.com/pldg/scroll-interactions}
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).scroll_interactions=t()}(this,(function(){"use strict";function e(e){return"number"==typeof e&&!isNaN(parseFloat(e))}function t(e){return"string"==typeof e&&e.length>0}return function(n){var r=n.trigger;void 0===r&&(r=1);var o=n.progress;void 0===o&&(o=!1);var i=n.debug;void 0===i&&(i=!1);var s=n.root;void 0===s&&(s=null);var c,u,a,l,d,f,p=n.targets,v=n.unobserve,g=n.throttle,w=(c=0,u="down",function(){var e=s?s.scrollTop:window.pageYOffset,t=u;return e>c||e===c&&"down"===u?t="down":(e<c||e===c&&"up"===u)&&(t="up"),c=e,u=t,t}),b=!!o&&function(){var e=!1;try{var t={get passive(){e={passive:!0}}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}(),h=o&&"intersect"!==v,y={},m=[],E=[],x=!1,L=!0;function O(e){var t=document.createElement("div"),n=document.createElement("p");if(t.style.height="0px",t.style.borderTop="2px dashed grey",t.style.zIndex="9999",e){var o=e.getBoundingClientRect(),i=o.height,s=o.width;t.style.position="absolute",t.style.top=r*i+function(e){var t=window.pageYOffset,n=window.pageXOffset,r=document.body.clientTop||0,o=document.body.clientLeft||0,i=e.getBoundingClientRect(),s=i.top,c=i.left,u=i.height,a=i.width;return{top:s=s+t-r,left:c=c+n-o,height:u,width:a,bottom:s+u,right:c+a}}(e).top+"px",t.style.width=s+"px"}else t.style.position="fixed",t.style.width="100%",t.style.top=100*r+"vh";t.setAttribute("class",S()),n.style.fontFamily="monospace",n.style.color="grey",n.style.margin="0",n.style.padding="6px",n.innerText='targets: "'+p+'", trigger: '+r,t.appendChild(n),document.body.appendChild(t)}function S(){return"scroll-interactions--trigger-"+("."===p[0]||"#"===p[0]?p.substring(1):p)}function C(e){var t=100*e;return"-"+t+"% 0% -"+(100-t)+"% 0%"}function I(e,t){h&&(f=e[0].rootBounds.top),d&&e.forEach((function(e){var n=function(e){var t=e.isIntersecting,n=e.rootBounds.top,r=e.boundingClientRect.top>n;return t?"intersect":!t&&r?"below":"above"}(e),r=e.target,o=parseInt(r.dataset.scrollInteractions);d({direction:w(),progress:h?q(e):null,position:n,entry:e}),L&&h&&function(e){var t=function(e){return g?(t=o,n=g,r=Date.now(),function(){r+n-Date.now()<0&&(t(),r=Date.now())}):o;var t,n,r;function o(t){d({direction:w(),progress:q(e),position:"intersect",entry:e})}}(e);E.push({addScroll:function(){return window.addEventListener("scroll",t,b)},removeScroll:function(){return window.removeEventListener("scroll",t,b)}})}(e),h&&function(e,t){var n=e.isIntersecting,r=E[t],o=r.addScroll,i=r.removeScroll;n?o():n||L||i()}(e,o),v&&(!function(e,t,n){var r="below"===v&&"below"===e,o="intersect"===v&&"intersect"===e,i="above"===v&&"above"===e;("onLoad"===v||r||o||i)&&n.unobserve(t)}(n,r,t),m.push(o))})),L&&(L=!1)}function q(e){var t=e.target.getBoundingClientRect(),n=t.top,r=1/(t.height/(f-n));return r<0?0:r>1?1:parseFloat(r.toFixed(4))}function B(){throw new Error("`scroll-interactions` has not been initialized")}return y.init=function(){if(x)throw new Error("`scroll-interactions` has been already initialized");return function(){if(t(p)||n("targets"),!e(r)||r>1||r<0)throw new Error("`trigger` must be a number in 0..1 range");if(v){if(!(["onLoad","below","intersect","above"].indexOf(v)>-1))throw new Error('`unobserve` must be equal to: "onLoad" or "below" or "intersect" or "above"');if(o&&"intersect"===v)throw new Error('If `progress === true`, `unobserve` can\'t be equal to "intersect"')}if(!e(g)&&g>0)throw new Error("`throttle` must be a number > 0");function n(e){throw new Error("`"+e+"` must be a valid DOM selector")}s&&!t(s)&&n("root")}(),t(s)&&(a=document.querySelector(s)),!0===i&&O(a),l=new IntersectionObserver(I,{rootMargin:C(r),root:a||null}),[].slice.call(document.querySelectorAll(p)).forEach((function(e,t){e.hasAttribute("data-scroll-interactions")||e.setAttribute("data-scroll-interactions",t),-1===m.indexOf(t)&&l.observe(e)})),x=!0,y},y.observe=function(e){if(x||B(),"function"!=typeof e)throw new Error("`observe` requires a function");return d=e,y},y.disconnect=function(e){var t;return void 0===e&&(e=!1),x||B(),o&&E.forEach((function(e){return(0,e.removeScroll)()})),!0===i&&(t=document.querySelector("."+S())).parentNode.removeChild(t),e&&m.splice(0),l.disconnect(),x=!1,y},y.update=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=!1),y.disconnect(t),p=e.targets||p,r=e.trigger||r,v=e.unobserve||v,o=e.progress||o,g=e.throttle||g,s=e.root||s,i=e.debug||i,y.init(),y},Object.freeze(y)}}));
