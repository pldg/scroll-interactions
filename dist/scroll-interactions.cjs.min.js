/**
 * @author Luca Poldelmengo
 * @license MIT
 * @see {@link https://github.com/pldg/scroll-interactions}
 */
"use strict";function e(e){return"number"==typeof e&&!isNaN(parseFloat(e))}function t(e){return"string"==typeof e&&e.length>0}module.exports=function(r){var n=r.trigger;void 0===n&&(n=1);var o=r.progress;void 0===o&&(o=!1);var i=r.debug;void 0===i&&(i=!1);var s=r.root;void 0===s&&(s=null);var c,u,a,l,d,f,v=r.targets,p=r.unobserve,g=r.throttle,w=(c=0,u="down",function(){var e=s?s.scrollTop:window.pageYOffset,t=u;return e>c||e===c&&"down"===u?t="down":(e<c||e===c&&"up"===u)&&(t="up"),c=e,u=t,t}),b=!!o&&function(){var e=!1;try{var t={get passive(){e={passive:!0}}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}(),h=o&&"intersect"!==p,y={},m=[],E=[],x=!1,L=!0;function O(e){var t=document.createElement("div"),r=document.createElement("p");if(t.style.height="0px",t.style.borderTop="2px dashed grey",t.style.zIndex="9999",e){var o=e.getBoundingClientRect(),i=o.height,s=o.width;t.style.position="absolute",t.style.top=n*i+function(e){var t=window.pageYOffset,r=window.pageXOffset,n=document.body.clientTop||0,o=document.body.clientLeft||0,i=e.getBoundingClientRect(),s=i.top,c=i.left,u=i.height,a=i.width;return{top:s=s+t-n,left:c=c+r-o,height:u,width:a,bottom:s+u,right:c+a}}(e).top+"px",t.style.width=s+"px"}else t.style.position="fixed",t.style.width="100%",t.style.top=100*n+"vh";t.setAttribute("class",S()),r.style.fontFamily="monospace",r.style.color="grey",r.style.margin="0",r.style.padding="6px",r.innerText='targets: "'+v+'", trigger: '+n,t.appendChild(r),document.body.appendChild(t)}function S(){return"scroll-interactions--trigger-"+("."===v[0]||"#"===v[0]?v.substring(1):v)}function C(e){var t=100*e;return"-"+t+"% 0% -"+(100-t)+"% 0%"}function I(e,t){h&&(f=e[0].rootBounds.top),d&&e.forEach((function(e){var r=function(e){var t=e.isIntersecting,r=e.rootBounds.top,n=e.boundingClientRect.top>r;return t?"intersect":!t&&n?"below":"above"}(e),n=e.target,o=parseInt(n.dataset.scrollInteractions);d({direction:w(),progress:h?q(e):null,position:r,entry:e}),L&&h&&function(e){var t=function(e){return g?(t=o,r=g,n=Date.now(),function(){n+r-Date.now()<0&&(t(),n=Date.now())}):o;var t,r,n;function o(t){d({direction:w(),progress:q(e),position:"intersect",entry:e})}}(e);E.push({addScroll:function(){return window.addEventListener("scroll",t,b)},removeScroll:function(){return window.removeEventListener("scroll",t,b)}})}(e),h&&function(e,t){var r=e.isIntersecting,n=E[t],o=n.addScroll,i=n.removeScroll;r?o():r||L||i()}(e,o),p&&(!function(e,t,r){var n="below"===p&&"below"===e,o="intersect"===p&&"intersect"===e,i="above"===p&&"above"===e;("onLoad"===p||n||o||i)&&r.unobserve(t)}(r,n,t),m.push(o))})),L&&(L=!1)}function q(e){var t=e.target.getBoundingClientRect(),r=t.top,n=1/(t.height/(f-r));return n<0?0:n>1?1:parseFloat(n.toFixed(4))}function B(){throw new Error("`scroll-interactions` has not been initialized")}return y.init=function(){if(x)throw new Error("`scroll-interactions` has been already initialized");return function(){if(t(v)||r("targets"),!e(n)||n>1||n<0)throw new Error("`trigger` must be a number in 0..1 range");if(p){if(!(["onLoad","below","intersect","above"].indexOf(p)>-1))throw new Error('`unobserve` must be equal to: "onLoad" or "below" or "intersect" or "above"');if(o&&"intersect"===p)throw new Error('If `progress === true`, `unobserve` can\'t be equal to "intersect"')}if(!e(g)&&g>0)throw new Error("`throttle` must be a number > 0");function r(e){throw new Error("`"+e+"` must be a valid DOM selector")}s&&!t(s)&&r("root")}(),t(s)&&(a=document.querySelector(s)),!0===i&&O(a),l=new IntersectionObserver(I,{rootMargin:C(n),root:a||null}),[].slice.call(document.querySelectorAll(v)).forEach((function(e,t){e.hasAttribute("data-scroll-interactions")||e.setAttribute("data-scroll-interactions",t),-1===m.indexOf(t)&&l.observe(e)})),x=!0,y},y.observe=function(e){if(x||B(),"function"!=typeof e)throw new Error("`observe` requires a function");return d=e,y},y.disconnect=function(e){var t;return void 0===e&&(e=!1),x||B(),o&&E.forEach((function(e){return(0,e.removeScroll)()})),!0===i&&(t=document.querySelector("."+S())).parentNode.removeChild(t),e&&m.splice(0),l.disconnect(),x=!1,y},y.update=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=!1),y.disconnect(t),v=e.targets||v,n=e.trigger||n,p=e.unobserve||p,o=e.progress||o,g=e.throttle||g,s=e.root||s,i=e.debug||i,y.init(),y},Object.freeze(y)};
