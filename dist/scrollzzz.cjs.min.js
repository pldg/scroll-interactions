/**
 * @license MIT
 * @author Luca Poldelmengo
 * @see {@link https://github.com/pldg/scrollzzz}
 */
"use strict";function addPassiveIfSupported(){var e=!1;try{var t={get passive(){e={passive:!0}}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}function addThrottle(e,t){var r=Date.now();return function(){r+t-Date.now()<0&&(e(),r=Date.now())}}function getCoords(e){var t=window.pageYOffset,r=window.pageXOffset,n=document.body.clientTop||0,o=document.body.clientLeft||0,i=e.getBoundingClientRect(),s=i.top,u=i.left,c=i.height,l=i.width;return{top:s=s+t-n,left:u=u+r-o,height:c,width:l,bottom:s+c,right:u+l}}function isNumber(e){return"number"==typeof e&&!isNaN(parseFloat(e))}function isNonEmptyString(e){return"string"==typeof e&&e.length>0}function scrollzzz(e){var t=e.trigger;void 0===t&&(t=1);var r=e.progress;void 0===r&&(r=!1);var n=e.debug;void 0===n&&(n=!1);var o=e.root;void 0===o&&(o=null);var i,s,u,c,l,d,a=e.targets,f=e.unobserve,p=e.throttle,g=(i=0,s="down",function(){var e=o?o.scrollTop:window.pageYOffset,t=s;return e>i||e===i&&"down"===s?t="down":(e<i||e===i&&"up"===s)&&(t="up"),i=e,s=t,t}),v={},w=[],b=!1,h=!!r&&addPassiveIfSupported(),m=[],y=!0;function z(){return"scrollzzz-trigger--"+("."===a[0]||"#"===a[0]?a.substring(1):a)}function E(e,t){r&&(d=e[0].rootBounds.top),l&&e.forEach((function(e){var n=function(e){var t=e.isIntersecting,r=e.rootBounds.top,n=e.boundingClientRect.top>r;return t?"intersect":!t&&n?"below":"above"}(e),o=e.target,i=parseInt(o.dataset.scrollzzz);l({direction:g(),progress:r?S(e):null,position:n,entry:e}),r&&y&&function(e){var t=function(e){return p?addThrottle(t,p):t;function t(t){l({direction:g(),progress:S(e),position:"intersect",entry:e})}}(e);m.push({addScroll:function(){return window.addEventListener("scroll",t,h)},removeScroll:function(){return window.removeEventListener("scroll",t,h)}})}(e),r&&function(e,t){var r=e.isIntersecting,n=m[t],o=n.addScroll,i=n.removeScroll;r?o():r||y||i()}(e,i),f&&(!function(e,t,r){var n="intersect"===f&&"intersect"===e,o="above"===f&&"above"===e;("below"===f&&"below"===e||n||o)&&r.unobserve(t)}(n,o,t),w.push(i))})),y&&(y=!1)}function S(e){var t=e.target.getBoundingClientRect(),r=t.top,n=1/(t.height/(d-r));return n<0?0:n>1?1:parseFloat(n.toFixed(4))}function x(){throw new Error("scrollzzz has not been initialized")}return v.init=function(){if(b)throw new Error("scrollzzz has beed already initialized");var e;return function(){if(isNonEmptyString(a)||e("targets"),!isNumber(t)||t>1||t<0)throw new Error("trigger must be a number in 0..1 range");if(f){if(!(["below","intersect","above"].indexOf(f)>-1))throw new Error('unobserve must be "below" or "intersect" or "above"');if(r&&"intersecting"===f)throw new Error('if using progress, unobserve can not be "intersect"')}if(!isNumber(p)&&p>0)throw new Error("throttle must be a number > 0");function e(e){throw new Error(e+" must be a valid DOM selector")}o&&!isNonEmptyString(o)&&e("root")}(),isNonEmptyString(o)&&(u=document.querySelector(o)),!0===n&&function(e){var r=document.createElement("div"),n=document.createElement("p");if(r.style.height="0px",r.style.borderTop="2px dashed grey",r.style.zIndex="9999",e){var o=e.getBoundingClientRect(),i=o.height,s=o.width;r.style.position="absolute",r.style.top=t*i+getCoords(e).top+"px",r.style.width=s+"px"}else r.style.position="fixed",r.style.width="100%",r.style.top=100*t+"vh";n.style.fontFamily="monospace",n.style.color="grey",n.style.margin="0",n.style.padding="6px",n.innerText='targets: "'+a+'", trigger: '+t,r.setAttribute("class",z()),r.appendChild(n),document.body.appendChild(r)}(u),c=new IntersectionObserver(E,{rootMargin:(e=100*t,"-"+e+"% 0% -"+(100-e)+"% 0%"),root:u||null}),[].slice.call(document.querySelectorAll(a)).forEach((function(e,t){e.setAttribute("data-scrollzzz",t),-1===w.indexOf(t)&&c.observe(e)})),b=!0,v},v.observe=function(e){if(b||x(),"function"!=typeof e)throw new Error("observe requires a function");return l=e,v},v.disconnect=function(e){var t;return void 0===e&&(e=!1),b||x(),r&&m.forEach((function(e){return(0,e.removeScroll)()})),!0===n&&(t=document.querySelector("."+z())).parentNode.removeChild(t),e&&w.splice(0),c.disconnect(),b=!1,v},v.update=function(e,i){return void 0===e&&(e={}),void 0===i&&(i=!1),v.disconnect(i),a=e.targets||a,t=e.trigger||t,f=e.unobserve||f,r=e.progress||r,p=e.throttle||p,o=e.root||o,n=e.debug||n,v.init(),v},Object.freeze(v)}module.exports=scrollzzz;
