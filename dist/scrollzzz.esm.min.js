/**
 * @license MIT
 * @author Luca Poldelmengo
 * @see {@link https://github.com/pldg/scrollzzz}
 */
function t(t){return"number"==typeof t&&!isNaN(parseFloat(t))}function e(t){return"string"==typeof t&&t.length>0}export default function({trigger:n=1,progress:o=!1,debug:r=!1,root:i=null,targets:s,unobserve:c,throttle:l}){const u=function(){let t=0,e="down";return function(){const n=i?i.scrollTop:window.pageYOffset;let o=e;return n>t||n===t&&"down"===e?o="down":(n<t||n===t&&"up"===e)&&(o="up"),t=n,e=o,o}}(),d={},a=[];let f,g,p,w=!1;const b=!!o&&function(){let t=!1;try{const e={get passive(){t={passive:!0}}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){t=!1}return t}(),h=[];let v,y=o&&"intersect"!==c,m=!0;function z(t){const e=document.createElement("div"),o=document.createElement("p");if(e.style.height="0px",e.style.borderTop="2px dashed grey",e.style.zIndex="9999",t){const{height:o,width:r}=t.getBoundingClientRect();e.style.position="absolute",e.style.top=`${n*o+function(t){const e=window.pageYOffset,n=window.pageXOffset,o=document.body.clientTop||0,r=document.body.clientLeft||0;let{top:i,left:s,height:c,width:l}=t.getBoundingClientRect();return i=i+e-o,s=s+n-r,{top:i,left:s,height:c,width:l,bottom:i+c,right:s+l}}(t).top}px`,e.style.width=`${r}px`}else e.style.position="fixed",e.style.width="100%",e.style.top=`${100*n}vh`;o.style.fontFamily="monospace",o.style.color="grey",o.style.margin="0",o.style.padding="6px",o.innerText=`targets: "${s}", trigger: ${n}`,e.setAttribute("class",E()),e.appendChild(o),document.body.appendChild(e)}function E(){return`scrollzzz-trigger--${"."===s[0]||"#"===s[0]?s.substring(1):s}`}function x(){const t=100*n;return`-${t}% 0% -${100-t}% 0%`}function $(t,e){y&&(v=t[0].rootBounds.top),p&&t.forEach(t=>{const n=function(t){const e=t.isIntersecting,n=t.rootBounds.top,o=t.boundingClientRect.top>n;return e?"intersect":!e&&o?"below":"above"}(t),o=t.target,r=parseInt(o.dataset.scrollzzz);p({direction:u(),progress:y?L(t):null,position:n,entry:t}),m&&y&&function(t){const e=function(t){return l?function(t,e){let n=Date.now();return function(){n+e-Date.now()<0&&(t(),n=Date.now())}}(e,l):e;function e(e){p({direction:u(),progress:L(t),position:"intersect",entry:t})}}(t);h.push({addScroll:()=>window.addEventListener("scroll",e,b),removeScroll:()=>window.removeEventListener("scroll",e,b)})}(t),y&&function(t,e){const n=t.isIntersecting,{addScroll:o,removeScroll:r}=h[e];n?o():n||m||r()}(t,r),c&&(!function(t,e,n){const o="below"===c&&"below"===t,r="intersect"===c&&"intersect"===t,i="above"===c&&"above"===t;("onLoad"===c||o||r||i)&&n.unobserve(e)}(n,o,e),a.push(r))}),m&&(m=!1)}function L(t){const{top:e,height:n}=t.target.getBoundingClientRect(),o=1/(n/(v-e));return o<0?0:o>1?1:parseFloat(o.toFixed(4))}function O(){throw new Error("scrollzzz has not been initialized")}return d.init=()=>{if(w)throw new Error("scrollzzz has beed already initialized");return function(){if(e(s)||r("targets"),!t(n)||n>1||n<0)throw new Error("trigger must be a number in 0..1 range");if(c){if(!(["onLoad","below","intersect","above"].indexOf(c)>-1))throw new Error('unobserve must be "onLoad" or "below" or "intersect" or "above"');if(o&&"intersect"===c)throw new Error('if using progress, unobserve can not be "intersect"')}if(!t(l)&&l>0)throw new Error("throttle must be a number > 0");function r(t){throw new Error(`${t} must be a valid DOM selector`)}i&&!e(i)&&r("root")}(),e(i)&&(f=document.querySelector(i)),!0===r&&z(f),g=new IntersectionObserver($,{rootMargin:x(),root:f||null}),[].slice.call(document.querySelectorAll(s)).forEach((t,e)=>{t.hasAttribute("data-scrollzzz")||t.setAttribute("data-scrollzzz",e),-1===a.indexOf(e)&&g.observe(t)}),w=!0,d},d.observe=t=>{if(w||O(),"function"!=typeof t)throw new Error("observe requires a function");return p=t,d},d.disconnect=(t=!1)=>(w||O(),o&&h.forEach(({removeScroll:t})=>t()),!0===r&&function(){const t=document.querySelector(`.${E()}`);t.parentNode.removeChild(t)}(),t&&a.splice(0),g.disconnect(),w=!1,d),d.update=(t={},e=!1)=>(d.disconnect(e),s=t.targets||s,n=t.trigger||n,c=t.unobserve||c,o=t.progress||o,l=t.throttle||l,i=t.root||i,r=t.debug||r,d.init(),d),Object.freeze(d)}
