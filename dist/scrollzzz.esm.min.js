/**
 * @license MIT
 * @author Luca Poldelmengo
 * @see {@link https://github.com/pldg/scrollzzz}
 */
function e(e){return"number"==typeof e&&!isNaN(parseFloat(e))}function t(e){return"string"==typeof e&&e.length>0}export default function({trigger:n=1,progress:o=!1,debug:r=!1,root:i=null,targets:s,unobserve:c,throttle:l}){const u=function(){let e=0,t="down";return function(){const n=i?i.scrollTop:window.pageYOffset;let o=t;return n>e||n===e&&"down"===t?o="down":(n<e||n===e&&"up"===t)&&(o="up"),e=n,t=o,o}}(),d={},a=[];let f,g,p,w=!1;const b=!!o&&function(){let e=!1;try{const t={get passive(){e={passive:!0}}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}(),h=[];let v,y=!0;function m(e){const t=document.createElement("div"),o=document.createElement("p");if(t.style.height="0px",t.style.borderTop="2px dashed grey",t.style.zIndex="9999",e){const{height:o,width:r}=e.getBoundingClientRect();t.style.position="absolute",t.style.top=`${n*o+function(e){const t=window.pageYOffset,n=window.pageXOffset,o=document.body.clientTop||0,r=document.body.clientLeft||0;let{top:i,left:s,height:c,width:l}=e.getBoundingClientRect();return{top:i=i+t-o,left:s=s+n-r,height:c,width:l,bottom:i+c,right:s+l}}(e).top}px`,t.style.width=`${r}px`}else t.style.position="fixed",t.style.width="100%",t.style.top=`${100*n}vh`;o.style.fontFamily="monospace",o.style.color="grey",o.style.margin="0",o.style.padding="6px",o.innerText=`targets: "${s}", trigger: ${n}`,t.setAttribute("class",z()),t.appendChild(o),document.body.appendChild(t)}function z(){return`scrollzzz-trigger--${"."===s[0]||"#"===s[0]?s.substring(1):s}`}function E(){const e=100*n;return`-${e}% 0% -${100-e}% 0%`}function x(e,t){o&&(v=e[0].rootBounds.top),p&&e.forEach(e=>{const n=function(e){const t=e.isIntersecting,n=e.rootBounds.top,o=e.boundingClientRect.top>n;return t?"intersect":!t&&o?"below":"above"}(e),r=e.target,i=parseInt(r.dataset.scrollzzz);p({direction:u(),progress:o?$(e):null,position:n,entry:e}),o&&y&&function(e){const t=function(e){return l?function(e,t){let n=Date.now();return function(){n+t-Date.now()<0&&(e(),n=Date.now())}}(t,l):t;function t(t){p({direction:u(),progress:$(e),position:"intersect",entry:e})}}(e);h.push({addScroll:()=>window.addEventListener("scroll",t,b),removeScroll:()=>window.removeEventListener("scroll",t,b)})}(e),o&&function(e,t){const n=e.isIntersecting,{addScroll:o,removeScroll:r}=h[t];n?o():n||y||r()}(e,i),c&&(!function(e,t,n){const o="intersect"===c&&"intersect"===e,r="above"===c&&"above"===e;("below"===c&&"below"===e||o||r)&&n.unobserve(t)}(n,r,t),a.push(i))}),y&&(y=!1)}function $(e){const{top:t,height:n}=e.target.getBoundingClientRect(),o=1/(n/(v-t));return o<0?0:o>1?1:parseFloat(o.toFixed(4))}function O(){throw new Error("scrollzzz has not been initialized")}return d.init=()=>{if(w)throw new Error("scrollzzz has beed already initialized");return function(){if(t(s)||r("targets"),!e(n)||n>1||n<0)throw new Error("trigger must be a number in 0..1 range");if(c){if(!(["below","intersect","above"].indexOf(c)>-1))throw new Error('unobserve must be "below" or "intersect" or "above"');if(o&&"intersecting"===c)throw new Error('if using progress, unobserve can not be "intersect"')}if(!e(l)&&l>0)throw new Error("throttle must be a number > 0");function r(e){throw new Error(`${e} must be a valid DOM selector`)}i&&!t(i)&&r("root")}(),t(i)&&(f=document.querySelector(i)),!0===r&&m(f),g=new IntersectionObserver(x,{rootMargin:E(),root:f||null}),[].slice.call(document.querySelectorAll(s)).forEach((e,t)=>{e.setAttribute("data-scrollzzz",t),-1===a.indexOf(t)&&g.observe(e)}),w=!0,d},d.observe=e=>{if(w||O(),"function"!=typeof e)throw new Error("observe requires a function");return p=e,d},d.disconnect=(e=!1)=>(w||O(),o&&h.forEach(({removeScroll:e})=>e()),!0===r&&function(){const e=document.querySelector(`.${z()}`);e.parentNode.removeChild(e)}(),e&&a.splice(0),g.disconnect(),w=!1,d),d.update=(e={},t=!1)=>(d.disconnect(t),s=e.targets||s,n=e.trigger||n,c=e.unobserve||c,o=e.progress||o,l=e.throttle||l,i=e.root||i,r=e.debug||r,d.init(),d),Object.freeze(d)}
