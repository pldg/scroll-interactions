/**
 * @author Luca Poldelmengo
 * @license MIT
 * @see {@link https://github.com/pldg/scroll-interactions}
 */
function t(t){return"number"==typeof t&&!isNaN(parseFloat(t))}function e(t){return"string"==typeof t&&t.length>0}export default function({trigger:n=1,progress:o=!1,debug:r=!1,root:i=null,targets:s,unobserve:c,throttle:l}){const u=function(){let t=0,e="down";return function(){const n=i?i.scrollTop:window.pageYOffset;let o=e;return n>t||n===t&&"down"===e?o="down":(n<t||n===t&&"up"===e)&&(o="up"),t=n,e=o,o}}(),a=!!o&&function(){let t=!1;try{const e={get passive(){t={passive:!0}}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){t=!1}return t}(),d=o&&"intersect"!==c,f={},p=[],g=[];let w,b,h,v,y=!1,m=!0;function E(t){const e=document.createElement("div"),o=document.createElement("p");if(e.style.height="0px",e.style.borderTop="2px dashed grey",e.style.zIndex="9999",t){const{height:o,width:r}=t.getBoundingClientRect();e.style.position="absolute",e.style.top=`${n*o+function(t){const e=window.pageYOffset,n=window.pageXOffset,o=document.body.clientTop||0,r=document.body.clientLeft||0;let{top:i,left:s,height:c,width:l}=t.getBoundingClientRect();return i=i+e-o,s=s+n-r,{top:i,left:s,height:c,width:l,bottom:i+c,right:s+l}}(t).top}px`,e.style.width=`${r}px`}else e.style.position="fixed",e.style.width="100%",e.style.top=`${100*n}vh`;e.setAttribute("class",x()),o.style.fontFamily="monospace",o.style.color="grey",o.style.margin="0",o.style.padding="6px",o.innerText=`targets: "${s}", trigger: ${n}`,e.appendChild(o),document.body.appendChild(e)}function x(){return`scroll-interactions--trigger-${"."===s[0]||"#"===s[0]?s.substring(1):s}`}function $(t){const e=100*t;return`-${e}% 0% -${100-e}% 0%`}function L(t,e){d&&(v=t[0].rootBounds.top),h&&t.forEach(t=>{const n=function(t){const e=t.isIntersecting,n=t.rootBounds.top,o=t.boundingClientRect.top>n;return e?"intersect":!e&&o?"below":"above"}(t),o=t.target,r=parseInt(o.dataset.scrollInteractions);h({direction:u(),progress:d?O(t):null,position:n,entry:t}),m&&d&&function(t){const e=function(t){return l?function(t,e){let n=Date.now();return function(){n+e-Date.now()<0&&(t(),n=Date.now())}}(e,l):e;function e(e){h({direction:u(),progress:O(t),position:"intersect",entry:t})}}(t);g.push({addScroll:()=>window.addEventListener("scroll",e,a),removeScroll:()=>window.removeEventListener("scroll",e,a)})}(t),d&&function(t,e){const n=t.isIntersecting,{addScroll:o,removeScroll:r}=g[e];n?o():n||m||r()}(t,r),c&&(!function(t,e,n){const o="below"===c&&"below"===t,r="intersect"===c&&"intersect"===t,i="above"===c&&"above"===t;("onLoad"===c||o||r||i)&&n.unobserve(e)}(n,o,e),p.push(r))}),m&&(m=!1)}function O(t){const{top:e,height:n}=t.target.getBoundingClientRect(),o=1/(n/(v-e));return o<0?0:o>1?1:parseFloat(o.toFixed(4))}function S(){throw new Error("`scroll-interactions` has not been initialized")}return f.init=()=>{if(y)throw new Error("`scroll-interactions` has been already initialized");return function(){if(e(s)||r("targets"),!t(n)||n>1||n<0)throw new Error("`trigger` must be a number in 0..1 range");if(c){if(!(["onLoad","below","intersect","above"].indexOf(c)>-1))throw new Error('`unobserve` must be equal to: "onLoad" or "below" or "intersect" or "above"');if(o&&"intersect"===c)throw new Error('If `progress === true`, `unobserve` can\'t be equal to "intersect"')}if(!t(l)&&l>0)throw new Error("`throttle` must be a number > 0");function r(t){throw new Error(`\`${t}\` must be a valid DOM selector`)}i&&!e(i)&&r("root")}(),e(i)&&(w=document.querySelector(i)),!0===r&&E(w),b=new IntersectionObserver(L,{rootMargin:$(n),root:w||null}),[].slice.call(document.querySelectorAll(s)).forEach((t,e)=>{t.hasAttribute("data-scroll-interactions")||t.setAttribute("data-scroll-interactions",e),-1===p.indexOf(e)&&b.observe(t)}),y=!0,f},f.observe=t=>{if(y||S(),"function"!=typeof t)throw new Error("`observe` requires a function");return h=t,f},f.disconnect=(t=!1)=>(y||S(),o&&g.forEach(({removeScroll:t})=>t()),!0===r&&function(){const t=document.querySelector(`.${x()}`);t.parentNode.removeChild(t)}(),t&&p.splice(0),b.disconnect(),y=!1,f),f.update=(t={},e=!1)=>(f.disconnect(e),s=t.targets||s,n=t.trigger||n,c=t.unobserve||c,o=t.progress||o,l=t.throttle||l,i=t.root||i,r=t.debug||r,f.init(),f),Object.freeze(f)}
